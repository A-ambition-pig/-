---
typora-root-url: ./
---

# HDFS

HDFS（Hadoop Distributed File System），它是一个文件系统，用于存储文件，通过目录树来定位文件  

HDFS 的使用场景：适合一次写入，多次读出的场景。  



优点：高容错性、适合处理大数据、可构建在廉价机器上

缺点：不适合低延迟数据访问、无法高效的对大量小文件进行存储、不支持并发写入/文件修改

### 组成架构

![](/HDFS组成架构.png)

1）NameNode(nn):Master,管理者。

​	(1) 管理HDFS的名称空间

​	(2) 配置副本策略

​	(3) 管理数据块(block)映射信息

​	(4) 处理客户端读写请求

2）DataNode(dn):Slave，执行者。

​	(1) 存储实际的数据块

​	(2) 执行数据块的读/写操作

3）Client：客户端

​	(1) 文件切分。文件上传HDFS的时候，Client将文件切分成一个一个的Block，然后进行上传。

​	(2) 与NameNode交互，获取文件的位置信息。

​	(3) 与DataNode交互，读取或写入数据。

​	(4) Client提供一些命令来管理HDFS，比如NameNode格式化。

​	(5) Client可通过一些命令来访问HDFS，比如对HDFS增删改查操作。

4）Secondary NameNode：并非NameNode的热备。

​	(1) 辅助NameNode，分担其工作量，比如定期合并Fsimage和Edits，并推送给NameNode；

​	(2) 在紧急情况下，可辅助恢复NameNode.



###### hdfs文件块(面试重点)

HDFS中的文件在物理上是分块存储(Block)，块的大小可以通过配置参数(dfs.blocksize)来规定，**默认大小在Hadoop2.x/3.x版本中是128M，1.x版本是64M。**

![](/HDFS文件块大小.png)

思考：为什么块的大小不能设置太小，也不能设置太大？

(1) HDFS的块设置太小，会增加寻址时间，程序一直在找块的开始位置。

(2) 如果块设置的太大，从磁盘传输数据的时间会明显大于定位这个块开始位置所需的时间，导致程序在处理这块数据时，会非常慢。

**总结：HDFS块的大小设置主要取决于磁盘传输速率。**



### HDFS读写流程（面试重点）

#### 写流程

![](/HDFS写流程.png)

注意：7）客户端开始往dn1上传第一个Block，以packet为单位，dn1收到一个packet就会传给dn2，dn2往dn3...；dn1每传一个packet会放入一个应答到队列等待应答。



**机架感知（副本存储节点选择）**

![](/副本节点选择.png)

#### 读流程

![](/HDFS读流程.png)